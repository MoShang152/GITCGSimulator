## 面向状态

将游戏状态储存在一个独立单元之中, 所有逻辑单元并不储存任何状态数据, 仅根据状态工作.

### 状态类约定

状态类应该提供以下接口:

```
GameState:
    __init__():初始化游戏状态.
    clone():返回状态的深拷贝.
    get(location):根据位置标记返回特定数据.
    getX():返回特定区域的所有数据.
    numpy():返回状态的numpy格式.
```

状态类是一个read-only类. 所有对于状态的修改都交予外部类.

### 状态类实现

这里要解决分区定义问题和numpy格式. 格式最好能向前兼容, 以免mhy更新

## 消息处理

不管是什么架构, 七圣的消息(事件,效应等等)都遵循"就近原则". 即最近的事件最先被处理, 它看上去像一个栈结构, 但是如果一个事件包含了多个效应, 却又存在固定顺序. 所以总的来说是**宏观栈微观队列**的数据结构.

### 结算顺序

装备区, 角色状态区, 状态区, 召唤区, 支援区.

### 刷新逻辑

如果某个token场上已有, 则不会改变其位置而仅刷新其状态.

### 伤害流程

七圣的伤害状态机如下:

1. 确定伤害类型(附魔检查在这一阶段)
2. 进行元素反应
3. 确定伤害数值
4. 造成伤害
5. 进行减伤

伤害来源:

所有元素反应造成的伤害都视触发元素反应的单位为来源.

